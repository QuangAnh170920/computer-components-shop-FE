<dialog-header> </dialog-header>

<dialog-content>
  <form [formGroup]="form!">
    <div class="p-fluid">
      <div class="p-formgrid grid">
        <div class="field col-12 lg:col-6">
          <label htmlfor="title"
            >Mã sản phẩm<span class="p-error">*</span></label
          >
          <input
            pInputText
            formControlName="code"
            id="title"
            type="text"
            class="p-inputtext p-component p-element"
            [ngClass]="
              f['code'].errors && (f['code'].dirty || f['code'].touched)
                ? 'ng-dirty ng-invalid'
                : ''
            "
          />
          <span
            class="p-error font-italic"
            *ngIf="f['code'].errors && (f['code'].dirty || f['code'].touched)"
          >
            <small
              *ngIf="
                f['code'].errors['required'] || f['code'].errors['whitespace']
              "
              >Mã sản phẩm không được để trống</small
            >
            <small *ngIf="f['code'].errors['maxlength']"
              >Mã sản phẩm không được vượt quá 100 ký tự</small
            >
          </span>
        </div>
        <div class="field col-12 lg:col-6">
          <label htmlfor="display_order"
            >Tên sản phẩm<span class="p-error">*</span></label
          >
          <input
            pInputText
            formControlName="name"
            id="title"
            type="text"
            class="p-inputtext p-component p-element"
            [ngClass]="
              f['name'].errors && (f['name'].dirty || f['name'].touched)
                ? 'ng-dirty ng-invalid'
                : ''
            "
          />
          <span
            class="p-error font-italic"
            *ngIf="f['name'].errors && (f['name'].dirty || f['name'].touched)"
          >
            <small
              *ngIf="
                f['name'].errors['required'] || f['name'].errors['whitespace']
              "
              >Tên sản phẩm không được để trống</small
            >
            <small *ngIf="f['name'].errors['maxlength']"
              >Tên sản phẩm không được vượt quá 255 ký tự</small
            >
          </span>
        </div>
        <div class="field col-12 lg:col-6">
          <label htmlfor="display_order"
            >Hiệu suất<span class="p-error">*</span></label
          >
          <input
            pInputText
            formControlName="power"
            id="title"
            type="text"
            class="p-inputtext p-component p-element"
            placeholder="VD : 123W"
            [ngClass]="
              f['power'].errors && (f['power'].dirty || f['power'].touched)
                ? 'ng-dirty ng-invalid'
                : ''
            "
          />
          <span
            class="p-error font-italic"
            *ngIf="
              f['power'].errors && (f['power'].dirty || f['power'].touched)
            "
          >
            <small *ngIf="f['power'].errors['required']"
              >Hiệu suất không được để trống</small
            >
          </span>
        </div>
        <div class="field col-12 lg:col-6">
          <label htmlfor="display_order"
            >Giá<span class="p-error">*</span></label
          >
          <input
            pInputText
            formControlName="price"
            id="title"
            type="number"
            class="p-inputtext p-component p-element"
            [ngClass]="
              f['price'].errors && (f['price'].dirty || f['price'].touched)
                ? 'ng-dirty ng-invalid'
                : ''
            "
          />
          <span
            class="p-error font-italic"
            *ngIf="
              f['price'].errors && (f['price'].dirty || f['price'].touched)
            "
          >
            <small *ngIf="f['price'].errors['required']"
              >Giá sản phẩm không được để trống</small
            >
          </span>
        </div>
        <div class="field col-12 lg:col-6">
          <label htmlfor="display_order">Khuyến mãi</label>
          <p-dropdown
            formControlName="promotionId"
            [options]="promotionList"
            optionLabel="name"
            optionValue="id"
            placeholder="Chọn khuyến mãi cho sản phẩm"
            [filter]="true"
            filterBy="name"
            [showClear]="true"
          ></p-dropdown>
        </div>
        <div class="field col-12 lg:col-6">
          <label htmlfor="display_order">Giá sau khi có khuyến mãi</label>
          <input
            pInputText
            formControlName="finalTotalPrice"
            id="title"
            type="number"
            class="p-inputtext p-component p-element"
          />
        </div>
        <div class="field col-12 lg:col-6">
          <label htmlfor="display_order">Loại sản phẩm</label>
          <p-dropdown
            formControlName="categoryId"
            [options]="categoriesList"
            optionLabel="name"
            optionValue="id"
            placeholder="Chọn loại sản phẩm"
            [filter]="true"
            filterBy="name"
            [showClear]="true"
          ></p-dropdown>
        </div>
        <div class="field col-12 lg:col-6">
          <label>Thêm tính năng sản phẩm</label>
          <p-button
            (onClick)="addFeature()"
            label="Thêm tính năng sản phẩm"
            icon="pi pi-plus"
          />
        </div>
        <div class="field col-12 lg:col-12">
          <p-table
            #dt
            [value]="productFeatures.controls"
            [lazy]="true"
            [rows]="10"
            formArrayName="productFeatures"
            styleClass="datatable-responsive p-datatable-striped"
            [tableStyle]="{ 'min-width': '50rem' }"
          >
            <ng-template pTemplate="header">
              <tr>
                <th class="text-center" style="width: 2%">#</th>
                <th class="text-center">Tính năng</th>
                <th class="text-center" style="width: 15%">Độ ưu tiên</th>
                <th class="text-center" style="width: 15%">Thao tác</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item let-i="rowIndex">
              <tr [formGroupName]="i">
                <td class="text-center">{{ i + 1 }}</td>
                <td class="text-center">
                  <input
                    formControlName="feature"
                    pInputText
                    id="features"
                    style="max-height: 32px; max-width: 100%"
                    type="text"
                    class="p-inputtext p-component p-element"
                  />
                </td>
                <td class="text-center">
                  <input
                    formControlName="priority"
                    pInputText
                    id="priority"
                    style="max-height: 32px; max-width: 100%"
                    type="number"
                    class="p-inputtext p-component p-element"
                    min="1"
                    max="10"
                  />
                </td>
                <td class="text-center">
                  <i
                    (click)="removeFeature(i)"
                    class="pi pi-trash"
                    style="
                      font-size: 1.2rem;
                      color: #d32f2f;
                      cursor: pointer;
                      margin-left: 15px;
                    "
                  ></i>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="10" class="text-center">Chưa có tính năng nào!</td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <div class="field col-12 lg:col-6">
          <label for="imageUrl">Hình ảnh sản phẩm</label>
          <div class="file-upload">
            <input
              #fileInput
              type="file"
              (change)="onFileSelect($event)"
              accept="image/*"
              style="display: none"
            />
            <button
              type="button"
              (click)="fileInput.click()"
              class="p-button p-component p-button-text"
            >
              <i class="pi pi-upload"></i> Choose
            </button>
            <button
              type="button"
              (click)="uploadImage()"
              class="p-button p-component p-button-success"
              [disabled]="!imageUrl"
            >
              <i class="pi pi-check"></i> Upload
            </button>
            <button
              type="button"
              (click)="cancelImage()"
              class="p-button p-component p-button-danger"
              [disabled]="!imageUrl"
            >
              <i class="pi pi-times"></i> Cancel
            </button>
          </div>
        </div>
        
        <div class="field col-12 lg:col-6">
          <label for="imageUrl">Ảnh sản phẩm</label>
          <div *ngIf="imageUrl || form?.get('imageUrl')?.value">
            <img
              [src]="imageUrl || form?.get('imageUrl')?.value"
              alt="Product Image"
              class="product-image"
              style="max-width: 100%; max-height: 200px; border-radius: 8px;"
            />
            <button
              type="button"
              (click)="removeCurrentImage()"
              class="p-button p-component p-button-danger"
            >
              <i class="pi pi-trash"></i> Remove Image
            </button>
          </div>
        </div>
        

        <div class="field col-12 lg:col-12">
          <label htmlfor="note">Mô tả</label>
          <textarea
            pTextArea
            id="description"
            formControlName="description"
            rows="5"
            cols="30"
            pInputTextarea
            type="text"
            class="p-inputtext p-component p-element"
          >
          </textarea>
        </div>
      </div>
    </div>
  </form>
</dialog-content>

<dialog-footer
  [isOnSave]="action !== 'view'"
  (onClose)="close()"
  (onSave)="save()"
  [isOnSaveContinue]="action === 'insert'"
  [disabledSave]="form!.invalid"
  [cancelLabel]="action === 'view' ? 'Đóng' : 'Huỷ'"
>
</dialog-footer>
